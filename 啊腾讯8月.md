#### **腾讯8月**

##### **1.详细讲讲TCP的建连和断连的过程？time_wait会占用哪些资源？连接数操作系统有上限吗？描述符最大可以配置多少？** 

因为要等2msl，所以相当于连接仍存在，消耗端口和内存

序列号确认号状态位，syn-sent等状态

端口资源内存资源

服务端单个端口理论最大：客户端ip*端口 = 2^32 * 2^16，实际受文件描述符和内存限制

##### **2.有使用过抓包工具吗？** 

##### **3.如果让你自己写一个TCP建连断连，你会用到哪些系统函数？**

服务端：

socket：创建一个socket，返回文件描述符

bind：给创建的socket绑定ip，端口号，之后用它监听客户端连接

listen：开始监听，维护全连接队列和半连接队列

accept：收到第一次握手后被调用，阻塞，等待收到第三次握手后，返回从全连接队列取出的已连接socket

connect：客户端用此函数向服务端建联，成功返回1，失败返回0。收到1后就知道可以通过socket传数据了

close：客户端调用close，发送fin报文，服务端接收第一次挥手，read返回eof；客户端调用close，发第三次挥手的fin，挥手完成，进入close状态后，释放资源

补：创建一个socket后，内核态会给他分配资源，如内存空间用于储存(源ip，目标io等信息)，文件描述符就是用户态用来访问这些资源的，类似一个指针

##### 4.了解过字节序吗？大小端？

##### 5.epoll的有几种触发模式？这几种模式有什么区别？

边缘水平

##### 6.讲一下TCP滑动窗口的作用以及原理；流量控制是什么？超时重发的场景是什么？讲讲超时重传的过程；

重传：超时重传(时间略大约2rtt，动态变化)，快速重传(连续3个相同的ack，没超时也重传)

滑动窗口：提高效率+流量控制——无需确认，仍能发送的最大数据量，避免一问一答，提高吞吐量；同时保证不超过接收方处理能力(大小由接收方指定，动态变化)

原理：四个分区，接收方三个，已发送没ack的存到操作系统内存缓冲区，丢包重发。

场景：网络拥塞丢包，接收方处理能力不够丢包，ack丢失

过程：发包的时候设置个定时器，收到ack取消定时器，超时重传还会触发拥塞控制算法，时间间隔通过采样rtt计算

##### 7.TCP接收双方都会有一个buffer队列，数据的几个状态是什么？发送窗口几个状态，接收窗口几个状态

相当于考滑动窗口的分区：已发送并ack，已发送未ack，未发送能发送，未发送超出窗口范围，不能发送；

已接受并ack，未接收能接收，不能接收

##### 8.一个包已经到网卡了，阐述一下从网卡到应用层的过程

 网卡光电信号到数字信号，去帧头帧尾，看mac头判断是不是给自己的——判断协议栈ip，tcp——read()从socket buffer读数据，返回结果

read()阻塞(前置)——网卡收到数据包，DMA到内核，中断通知内核有数据了，内核处理，read返回

网卡/磁盘——内核——用户，第一步DMA，第二部CPU

##### 9.给你10亿个无序的数字，请你设计一种方法取出前一百个数字，时间复杂度是多少？就是个topK 

100个元素的小顶堆，比堆顶大就入堆，然后重新排序，建堆/下沉时间o(logk),k为堆大小，遍历n个元素，所以复杂度Onlogk

每个跟节点都小于他所有的子节点就较堆

todo 堆排序算法

##### 10.设计一个方法检测流程图里是否有环？ 



##### 11.图的表示方式有哪些？ 

##### 12.在分布式场景下如何保证数据的强一致性？了解过哪些分布式数据强一致性的方法？

##### 13.raft,paxos

##### 14.负载均衡有哪些算法？

##### 15.讲讲 redis 的持久化 

##### 16.进程间通信有哪些？ 

##### 17.有了解过字节对齐吗？字节对齐的作用是什么？



#### 饿了么电话一面

##### mysql如何实现如果不存在就插入如果存在就更新？

```
INSERT INTO users (id, name) VALUES (1, 'Alice')
ON DUPLICATE KEY UPDATE name = VALUES(name);
```

##### 数据库访问量过大怎么办？

单表：创建索引，优化查询(*,覆盖)，避免索引失效

其他：分库分表，读写分离，使用缓存

##### redis hotkey用什么查，怎么解决hotkey？

